@model Academy.Domain.ViewModels.Role.AdminSideSetPermissionToRoleViewModel
@{
    ViewData["Title"] = "افزودن دسترسی به نقش";
}

@section Breadcrumb







{
    <admin-breadcrumb>
        <admin-breadcrumb-item asp-area="Admin" asp-controller="Role" asp-action="List">لیست نقش ها
        </admin-breadcrumb-item>
        <admin-breadcrumb-item last-active-item="true">@ViewData["Title"]</admin-breadcrumb-item>
    </admin-breadcrumb>
}

@section Scripts{
    <script src="/admin/js/permissions.js" asp-append-version="true"></script>
}


<div class="grid grid-cols-12 gap-x-6 gap-y-10">
    <div class="col-span-12">
        <div class="mt-3.5 flex flex-col gap-8">

            <div class="box box--stacked flex flex-col">
                <div class="flex flex-col gap-y-2 p-5 sm:flex-row sm:items-center">
                    <h3 class="text-base font-bold opacity-95">@ViewData["Title"]</h3>
                </div>
            </div>


            <div class="box box--stacked flex flex-col">
                <form asp-area="Admin" asp-controller="Role" asp-action="SetPermissionToRole" method="post">
                    <input asp-for="RoleId" type="hidden"/>
                    <div class="p-5">

                        @if (Model.Permissions.Any() && Model.Permissions is not null)
                        {
                            <div class="grid grid-cols-1 !md:grid-cols-3 gap-4">
                                @foreach (var item in Model.Permissions.Where(s => s.ParentId == null))
                                {
                                    bool isSelected = Model.SelectedPermissionIds.Any(s => s == item.Id);
                                    <div>
                                        <div class="mt-4 flex flex-col gap-3.5 permission-grand">
                                            <div class="flex items-center ">

                                                <input type="checkbox"
                                                       class="parent transition-all duration-100 ease-in-out shadow-sm border-slate-200 cursor-pointer focus:ring-4 focus:ring-offset-0 focus:ring-primary focus:ring-opacity-20 dark:bg-darkmode-800 dark:border-transparent dark:focus:ring-slate-700 dark:focus:ring-opacity-50 [&amp;[type='radio']]:checked:bg-primary [&amp;[type='radio']]:checked:border-primary [&amp;[type='radio']]:checked:border-opacity-10 [&amp;[type='checkbox']]:checked:bg-primary [&amp;[type='checkbox']]:checked:border-primary [&amp;[type='checkbox']]:checked:border-opacity-10 [&amp;:disabled:not(:checked)]:bg-slate-100 [&amp;:disabled:not(:checked)]:cursor-not-allowed [&amp;:disabled:not(:checked)]:dark:bg-darkmode-800/50 [&amp;:disabled:checked]:opacity-70 [&amp;:disabled:checked]:cursor-not-allowed [&amp;:disabled:checked]:dark:bg-darkmode-800/50 w-[38px] h-[24px] p-px rounded-full relative before:w-[20px] before:h-[20px] before:shadow-[1px_1px_3px_rgba(0,0,0,0.25)] rtl:before:transition-[margin-right] ltr:before:transition-[margin-left] before:duration-200 before:ease-in-out before:absolute before:inset-y-0 before:my-auto before:rounded-full before:dark:bg-darkmode-600 checked:bg-primary checked:border-primary checked:bg-none rtl:before:checked:mr-[14px] ltr:before:checked:ml-[14px] before:checked:bg-white"
                                                       id="@item.Id" name="PermissionIds"
                                                       @(isSelected ? "checked='checked'" : string.Empty)
                                                       value="@item.Id">
                                                <label class="cursor-pointer rtl:mr-2 ltr:ml-2" for="@item.Id">
                                                    @item.DisplayName
                                                </label>
                                            </div>
                                        </div>
                                        <div class="ps-3 my-3 grid grid-cols-1 gap-3 child-list">
                                            @{
                                                var children = Model.Permissions.Where(s => s.ParentId == item.Id).ToList();
                                                foreach (var child in children)
                                                {
                                                    bool isChildSelected = Model.SelectedPermissionIds.Any(s => s == child.Id);

                                                    <div class="mt-4 flex flex-col gap-3.5">
                                                        <div class="flex items-center ">

                                                            <input type="checkbox"
                                                                   class="permission-child transition-all duration-100 ease-in-out shadow-sm border-slate-200 cursor-pointer focus:ring-4 focus:ring-offset-0 focus:ring-primary focus:ring-opacity-20 dark:bg-darkmode-800 dark:border-transparent dark:focus:ring-slate-700 dark:focus:ring-opacity-50 [&amp;[type='radio']]:checked:bg-primary [&amp;[type='radio']]:checked:border-primary [&amp;[type='radio']]:checked:border-opacity-10 [&amp;[type='checkbox']]:checked:bg-primary [&amp;[type='checkbox']]:checked:border-primary [&amp;[type='checkbox']]:checked:border-opacity-10 [&amp;:disabled:not(:checked)]:bg-slate-100 [&amp;:disabled:not(:checked)]:cursor-not-allowed [&amp;:disabled:not(:checked)]:dark:bg-darkmode-800/50 [&amp;:disabled:checked]:opacity-70 [&amp;:disabled:checked]:cursor-not-allowed [&amp;:disabled:checked]:dark:bg-darkmode-800/50 w-[38px] h-[24px] p-px rounded-full relative before:w-[20px] before:h-[20px] before:shadow-[1px_1px_3px_rgba(0,0,0,0.25)] rtl:before:transition-[margin-right] ltr:before:transition-[margin-left] before:duration-200 before:ease-in-out before:absolute before:inset-y-0 before:my-auto before:rounded-full before:dark:bg-darkmode-600 checked:bg-primary checked:border-primary checked:bg-none rtl:before:checked:mr-[14px] ltr:before:checked:ml-[14px] before:checked:bg-white"
                                                                   id="@child.Id"
                                                                   name="PermissionIds"
                                                                   @(isChildSelected ? "checked='checked'" : string.Empty)
                                                                   value="@child.Id">
                                                            <label class="cursor-pointer rtl:mr-2 ltr:ml-2"
                                                                   for="@child.Id">
                                                                @child.DisplayName
                                                            </label>
                                                        </div>
                                                    </div>
                                                }
                                            }
                                        </div>

                                    </div>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="overflow-auto xl:overflow-visible">
                                <partial name="_NotFoundPartial"/>
                            </div>
                        }

                        <div class="flex justify-end !my-5">
                            <button type="submit" data-tw-merge=""
                                    class="transition duration-200 border shadow-sm inline-flex items-center justify-center py-2 rounded-md font-medium cursor-pointer focus:ring-4 focus:ring-primary focus:ring-opacity-20 focus-visible:outline-none dark:focus:ring-slate-700 dark:focus:ring-opacity-50 [&:hover:not(:disabled)]:bg-opacity-90 [&:hover:not(:disabled)]:border-opacity-90 [&:not(button)]:text-center disabled:opacity-70 disabled:cursor-not-allowed text-primary dark:border-primary [&:hover:not(:disabled)]:bg-primary/10 w-full border-primary/50 px-10 md:w-auto">
                                <i data-tw-merge="" data-lucide="pocket"
                                   class="rtl:-mr-2 ltr:-ml-2 rtl:ml-2 ltr:mr-2 h-4 w-4 stroke-[1.3]"></i>
                                ثبت تغییرات
                            </button>
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
</div>

